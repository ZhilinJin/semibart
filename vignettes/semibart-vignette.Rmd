---
title: "semibart documentation"
author: "Bret Zeldow"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{semibart documentation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction

This document is intended to provide documentation for the semibart package in R. Let $Y$ be the outcome, which can be continuous or binary. Let $X$ represent covariates, which may be predictors of $Y$. The most common way to model the relationship between $X$ and $Y$ is linear regression, which typically assumes (for continuous outcomes) that $Y = X \beta + \epsilon$. In practice, there is often there is just one covariate of scientific interest--an exposure or a treatment, which we'll call $A$. Now, $X = (L, A)$ and $L$ contains the remaining covariates. To get the effect of $A$ on $Y$, we must also adjust for covariates $L$. This can be done in linear regression but comes at the cost of imposing linearity on the mean function. Furthermore, any interactions must be specified by the analyst. Our package allows you to model the relationship between $L$ and $Y$ nonparametrically, where nonlinearities and interactions are detected automatically. This is done through Bayesian Additive Regression Trees (BART). The exposure of $A$ is still modeled linearly as in linear regression. If desired, it is also possible to include effect modifiers of $A$ as a linear parameter.

Our model allows some of the predictors to be modeled nonparametrically with BART and other predictors to be modeled linearly. The model we fit can be written as $Y  = f(L) + A \psi + \epsilon$, where $f(\cdot)$ is fit using BART. We can also put more terms (and interactions) in the linear part by fitting something like $Y = f(L) + A \psi_1 + A L_1 \psi_2 + \epsilon$ or $Y = f(L_{-1}) + A \psi_1 + A L_1 \psi_2 + L_1 \psi_3 + \epsilon$ where $L_{-1}$ indicates all variables in $L$ except for $L_1$.

In addition to the typical prior assumptions and distributions on the BART part (see the BayesTree package), we also specify a multivariate normal prior distribution for $\psi$. That is, $\psi \sim N(0,\sigma^2_{\psi} I).$

When the outcome is binary, we use the probit link.


## Function and Arguments

The primary function in the semibart package is "semibart."

* x.train -- This is a matrix with each column containing a variable that is to be included in the BART part of the model
* a.train -- This is a design matrix for the linear part of the model. If there is only a single variable can use cbind(varname). If you want to include multiple variables or interactions, use cbind(varname1,varname2) or cbind(varname1,varname2,varname1*varname2). Must specifically put the interactions as a column of the matrix.
* y.train -- Vector of outcomes. Can be binary or numeric. If binary everything must be either 0 or 1. The function will automatically detect whether the outcome is binary or continuous.
* sigest -- Intial guess of the standard deviation of the regression error. If NA (the default), the function will use an estimate from least squares. This is set to 1 automatically if outcome is binary.

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
